<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Code de la Route - S√©n√©gal</title>
    <meta name="theme-color" content="#00853F">
    <style>
        :root {
            --green: #00853F;
            --green-dark: #006d33;
            --yellow: #FDEF42;
            --red: #E31B23;
            --bg: #0f172a;
            --bg-card: #1e293b;
            --bg-deep: #020617;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --primary: #38bdf8;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --radius: 12px;
        }
        * { margin:0; padding:0; box-sizing:border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
        }

        /* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
        header {
            background: linear-gradient(135deg, var(--green), var(--green-dark));
            padding: 1rem 1.25rem;
            display: flex;
            align-items: center;
            gap: 0.875rem;
            box-shadow: 0 2px 12px rgba(0,133,63,0.4);
            position: sticky; top: 0; z-index: 100;
        }
        .flag { width:48px; height:32px; border-radius:3px; overflow:hidden; display:flex; flex-shrink:0; border:1px solid rgba(255,255,255,0.3); }
        .flag-g { flex:1; background:var(--green); }
        .flag-y { flex:1; background:var(--yellow); display:flex; align-items:center; justify-content:center; }
        .flag-r { flex:1; background:var(--red); }
        .flag-star { color:var(--green); font-size:14px; }
        .header-text h1 { font-size:1.1rem; font-weight:700; color:#fff; }
        .header-text p { font-size:0.75rem; color:rgba(255,255,255,0.8); }

        /* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
        .screen { display:none; padding:1rem; max-width:680px; margin:0 auto; }
        .screen.active { display:block; }

        /* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
        .card {
            background:var(--bg-card);
            border-radius:var(--radius);
            padding:1.5rem;
            margin-bottom:1rem;
            box-shadow:0 4px 12px rgba(0,0,0,0.3);
        }

        /* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
        .btn {
            background:var(--green);
            color:#fff; border:none;
            padding:0.875rem 1.5rem;
            border-radius:8px;
            font-size:0.95rem; font-weight:600;
            cursor:pointer; transition:all 0.2s;
            display:inline-flex; align-items:center; justify-content:center;
            gap:0.5rem; width:100%;
        }
        .btn:hover { background:var(--green-dark); transform:translateY(-1px); }
        .btn:active { transform:translateY(0); }
        .btn-outline {
            background:transparent;
            border:2px solid var(--primary);
            color:var(--primary);
        }
        .btn-outline:hover { background:var(--primary); color:var(--bg); }
        .btn-sm { padding:0.5rem 1rem; font-size:0.85rem; width:auto; }
        .btn-row { display:flex; gap:0.75rem; margin-top:1rem; }
        .btn-row .btn { flex:1; }

        /* ‚îÄ‚îÄ WELCOME ‚îÄ‚îÄ */
        .welcome-icon { font-size:3rem; text-align:center; margin-bottom:1rem; }
        .welcome-title { font-size:1.5rem; font-weight:700; text-align:center; margin-bottom:0.5rem; }
        .welcome-sub { color:var(--text-muted); text-align:center; margin-bottom:1.5rem; font-size:0.9rem; }
        .info-box {
            background:rgba(56,189,248,0.08);
            border-left:3px solid var(--primary);
            padding:1rem; border-radius:6px;
            margin-bottom:1.5rem; font-size:0.875rem;
        }
        .info-box ul { margin-left:1.25rem; margin-top:0.5rem; line-height:2; }

        /* ‚îÄ‚îÄ SERIES GRID ‚îÄ‚îÄ */
        .series-title { font-size:1.2rem; font-weight:700; margin-bottom:0.25rem; }
        .series-sub { color:var(--text-muted); font-size:0.875rem; margin-bottom:1.25rem; }
        .series-grid {
            display:grid;
            grid-template-columns:repeat(auto-fill, minmax(90px,1fr));
            gap:0.75rem;
        }
        .series-btn {
            background:var(--bg-deep);
            border:2px solid var(--green);
            color:var(--text);
            padding:1.1rem 0.5rem;
            border-radius:10px;
            font-size:1rem; font-weight:700;
            cursor:pointer; transition:all 0.2s;
            text-align:center; position:relative;
        }
        .series-btn:hover { background:var(--green); transform:scale(1.04); }
        .series-btn.done { border-color:var(--success); background:rgba(16,185,129,0.1); }
        .series-btn.done::after {
            content:'‚úì'; position:absolute; top:4px; right:6px;
            color:var(--success); font-size:0.85rem;
        }
        .series-btn .serie-score {
            display:block; font-size:0.7rem;
            color:var(--text-muted); font-weight:400; margin-top:3px;
        }

        /* ‚îÄ‚îÄ QUIZ HEADER ‚îÄ‚îÄ */
        .quiz-topbar {
            display:flex; justify-content:space-between; align-items:center;
            margin-bottom:0.875rem; gap:0.5rem;
        }
        .quiz-info { font-size:0.9rem; font-weight:600; color:var(--text-muted); }
        .quiz-serie { font-size:1rem; font-weight:700; color:var(--primary); }
        .timer {
            font-size:1rem; font-weight:700; color:var(--yellow);
            background:rgba(253,239,66,0.1); padding:0.3rem 0.75rem;
            border-radius:20px; border:1px solid rgba(253,239,66,0.3);
        }
        .progress-bar {
            background:var(--bg-deep); height:6px;
            border-radius:3px; overflow:hidden; margin-bottom:1rem;
        }
        .progress-fill {
            background:linear-gradient(90deg, var(--green), var(--yellow));
            height:100%; transition:width 0.4s ease;
        }

        /* ‚îÄ‚îÄ QUESTION CARD ‚îÄ‚îÄ */
        .question-card { background:var(--bg-card); border-radius:var(--radius); overflow:hidden; margin-bottom:1rem; }
        .question-img {
            width:100%; display:block;
            max-height:260px; object-fit:contain;
            background:#000; padding:0.5rem;
        }
        .question-img-placeholder {
            background:rgba(251,191,36,0.08);
            border-left:3px solid var(--warning);
            padding:0.75rem 1rem; font-size:0.8rem;
            color:var(--text-muted);
        }
        .question-body { padding:1rem; }

        /* ‚îÄ‚îÄ OPTIONS 2 COLONNES ‚îÄ‚îÄ */
        .options-grid {
            display:grid;
            grid-template-columns:1fr 1fr;
            gap:0.6rem;
        }
        @media(max-width:400px) {
            .options-grid { grid-template-columns:1fr; }
        }
        .option {
            background:var(--bg-deep);
            border:2px solid transparent;
            padding:0.75rem 0.875rem;
            border-radius:8px; cursor:pointer;
            transition:all 0.18s;
            display:flex; align-items:center; gap:0.6rem;
            font-size:0.875rem;
        }
        .option:hover:not(.locked) { border-color:var(--green); background:rgba(0,133,63,0.1); }
        .option.selected { border-color:var(--primary); background:rgba(56,189,248,0.1); }
        .option.correct { border-color:var(--success); background:rgba(16,185,129,0.15); }
        .option.incorrect { border-color:var(--error); background:rgba(239,68,68,0.1); }
        .option.locked { cursor:default; }
        .opt-letter {
            width:28px; height:28px; border-radius:50%;
            background:var(--bg-card);
            display:flex; align-items:center; justify-content:center;
            font-weight:700; font-size:0.8rem; flex-shrink:0;
        }
        .option.correct .opt-letter { background:var(--success); color:#fff; }
        .option.incorrect .opt-letter { background:var(--error); color:#fff; }
        .opt-text { flex:1; line-height:1.3; }

        /* ‚îÄ‚îÄ QUIZ ACTIONS ‚îÄ‚îÄ */
        .quiz-actions {
            display:flex; gap:0.75rem; align-items:center;
        }
        .quiz-actions .btn { flex:1; }
        .btn-prev { max-width:120px; }

        /* ‚îÄ‚îÄ ALERT REPONDRE ‚îÄ‚îÄ */
        .alert-answer {
            background:rgba(245,158,11,0.1);
            border:1px solid var(--warning);
            color:var(--warning);
            padding:0.6rem 1rem; border-radius:8px;
            font-size:0.85rem; text-align:center;
            margin-bottom:0.75rem; display:none;
        }
        .alert-answer.show { display:block; }

        /* ‚îÄ‚îÄ RESULTS ‚îÄ‚îÄ */
        .result-header { text-align:center; padding:1.5rem 1rem 1rem; }
        .result-badge {
            font-size:3.5rem; margin-bottom:0.75rem; display:block;
        }
        .result-verdict {
            font-size:1.6rem; font-weight:800; margin-bottom:0.25rem;
        }
        .result-verdict.admis { color:var(--success); }
        .result-verdict.ajourn { color:var(--error); }
        .result-serie { color:var(--text-muted); font-size:0.9rem; margin-bottom:1rem; }
        .result-stats {
            display:grid; grid-template-columns:repeat(3,1fr);
            gap:0.75rem; margin-bottom:1rem;
        }
        .stat-box {
            background:var(--bg-deep); border-radius:10px;
            padding:1rem 0.5rem; text-align:center;
        }
        .stat-val { font-size:1.6rem; font-weight:800; }
        .stat-lbl { font-size:0.72rem; color:var(--text-muted); margin-top:2px; }

        /* ‚îÄ‚îÄ TABLEAU CORRECTIONS ‚îÄ‚îÄ */
        .correction-title { font-size:1rem; font-weight:700; margin-bottom:0.875rem; }
        .questions-grid {
            display:grid;
            grid-template-columns:repeat(5,1fr);
            gap:0.5rem;
        }
        @media(min-width:500px) {
            .questions-grid { grid-template-columns:repeat(7,1fr); }
        }
        .q-cell {
            aspect-ratio:1;
            border-radius:8px; border:2px solid transparent;
            display:flex; align-items:center; justify-content:center;
            font-weight:700; font-size:0.85rem;
            cursor:pointer; transition:all 0.2s;
        }
        .q-cell.ok { background:rgba(16,185,129,0.15); border-color:var(--success); color:var(--success); }
        .q-cell.ko { background:rgba(239,68,68,0.15); border-color:var(--error); color:var(--error); }
        .q-cell:hover { transform:scale(1.1); box-shadow:0 2px 8px rgba(0,0,0,0.3); }

        /* ‚îÄ‚îÄ MODAL CORRECTION ‚îÄ‚îÄ */
        .modal-overlay {
            display:none; position:fixed; inset:0;
            background:rgba(0,0,0,0.85); z-index:200;
            padding:1rem; overflow-y:auto;
        }
        .modal-overlay.open { display:flex; align-items:flex-start; justify-content:center; }
        .modal {
            background:var(--bg-card); border-radius:var(--radius);
            width:100%; max-width:600px; overflow:hidden;
            margin:auto;
        }
        .modal-header {
            background:var(--bg-deep); padding:0.875rem 1rem;
            display:flex; justify-content:space-between; align-items:center;
        }
        .modal-header h3 { font-size:1rem; font-weight:700; }
        .modal-close {
            background:none; border:none; color:var(--text-muted);
            font-size:1.4rem; cursor:pointer; line-height:1; padding:0.25rem;
        }
        .modal-img {
            width:100%; display:block;
            max-height:300px; object-fit:contain;
            background:#000; padding:0.5rem;
        }
        .modal-options { padding:1rem; }
        .modal-option {
            display:flex; align-items:center; gap:0.75rem;
            padding:0.75rem 1rem; border-radius:8px;
            margin-bottom:0.5rem; font-size:0.9rem;
            border:2px solid transparent;
        }
        .modal-option.correct { border-color:var(--success); background:rgba(16,185,129,0.12); color:var(--success); }
        .modal-option.incorrect { border-color:var(--error); background:rgba(239,68,68,0.08); color:var(--error); }
        .modal-option.neutral { border-color:rgba(255,255,255,0.1); color:var(--text-muted); }
        .modal-opt-letter {
            width:30px; height:30px; border-radius:50%;
            display:flex; align-items:center; justify-content:center;
            font-weight:700; font-size:0.8rem; flex-shrink:0;
        }
        .modal-option.correct .modal-opt-letter { background:var(--success); color:#fff; }
        .modal-option.incorrect .modal-opt-letter { background:var(--error); color:#fff; }
        .modal-option.neutral .modal-opt-letter { background:var(--bg-deep); color:var(--text-muted); }
        .modal-legend {
            padding:0 1rem 1rem;
            display:flex; gap:1rem; font-size:0.78rem; color:var(--text-muted);
        }
        .modal-legend span { display:flex; align-items:center; gap:0.3rem; }

        /* ‚îÄ‚îÄ BACK BUTTON ‚îÄ‚îÄ */
        .back-btn {
            background:none; border:none; color:var(--text-muted);
            cursor:pointer; font-size:0.875rem; margin-bottom:1rem;
            display:flex; align-items:center; gap:0.4rem; padding:0;
        }
        .back-btn:hover { color:var(--text); }
    
        /* ‚îÄ‚îÄ COURS ‚îÄ‚îÄ */
        
        
        
        
        
        
        

        /* Contenu chapitre */
        
        
        
        

        
        .section-header {
            background:var(--bg-deep); padding:0.875rem 1rem;
            font-weight:700; font-size:0.95rem;
            display:flex; align-items:center; gap:0.5rem;
            cursor:pointer; user-select:none;
        }
        .section-header .sec-arrow { margin-left:auto; transition:transform 0.2s; }
        .section-header.open .sec-arrow { transform:rotate(180deg); }
        .section-body { padding:1rem; display:none; }
        .section-body.open { display:block; }

        .rule-item {
            display:flex; gap:0.75rem; align-items:flex-start;
            padding:0.6rem 0; border-bottom:1px solid rgba(255,255,255,0.05);
        }
        .rule-item:last-child { border-bottom:none; }
        .rule-icon { font-size:1.1rem; flex-shrink:0; margin-top:2px; }
        .rule-text { flex:1; font-size:0.875rem; line-height:1.5; }
        .rule-text strong { color:var(--primary); }
        .rule-text em { color:var(--warning); font-style:normal; }

        .panneau-grid {
            display:grid; grid-template-columns:repeat(2,1fr);
            gap:0.75rem;
        }
        @media(min-width:450px){ .panneau-grid { grid-template-columns:repeat(3,1fr); } }
        .panneau-card {
            background:var(--bg-deep); border-radius:8px;
            padding:0.875rem 0.5rem; text-align:center;
        }
        .panneau-symbol {
            font-size:2rem; display:block; margin-bottom:0.4rem;
        }
        .panneau-name { font-size:0.72rem; color:var(--text-muted); line-height:1.3; }
        .panneau-desc { font-size:0.78rem; font-weight:600; margin-top:0.3rem; }

        .alert-rule {
            background:rgba(239,68,68,0.1); border-left:3px solid var(--error);
            padding:0.75rem 1rem; border-radius:6px;
            font-size:0.85rem; margin-bottom:0.75rem; line-height:1.5;
        }
        .info-rule {
            background:rgba(56,189,248,0.08); border-left:3px solid var(--primary);
            padding:0.75rem 1rem; border-radius:6px;
            font-size:0.85rem; margin-bottom:0.75rem; line-height:1.5;
        }
        .success-rule {
            background:rgba(16,185,129,0.1); border-left:3px solid var(--success);
            padding:0.75rem 1rem; border-radius:6px;
            font-size:0.85rem; margin-bottom:0.75rem; line-height:1.5;
        }
        .vitesse-table { width:100%; border-collapse:collapse; font-size:0.82rem; }
        .vitesse-table th { background:var(--green); color:#fff; padding:0.5rem 0.75rem; text-align:left; }
        .vitesse-table td { padding:0.5rem 0.75rem; border-bottom:1px solid rgba(255,255,255,0.07); }
        .vitesse-table tr:nth-child(even) td { background:rgba(255,255,255,0.03); }
        .badge-v { background:var(--green); color:#fff; border-radius:20px; padding:2px 10px; font-weight:700; }

    
        /* ‚îÄ‚îÄ PANNEAUX MODULE ‚îÄ‚îÄ */
        .panneau-list-item {
            display:flex; align-items:flex-start; gap:0.75rem;
            padding:0.65rem 0; border-bottom:1px solid rgba(255,255,255,0.06);
            font-size:0.82rem;
        }
        .panneau-list-item:last-child { border-bottom:none; }
        .panneau-code {
            font-weight:800; color:var(--primary); min-width:50px;
            font-size:0.8rem; padding-top:2px; flex-shrink:0;
        }
        .panneau-def { flex:1; line-height:1.45; color:var(--text); }
        .panneau-cat-badge {
            display:inline-block; font-size:0.68rem; font-weight:700;
            padding:2px 8px; border-radius:20px; margin-bottom:0.75rem;
        }
        .badge-danger { background:rgba(239,68,68,0.2); color:#ef4444; border:1px solid #ef4444; }
        .badge-interdiction { background:rgba(239,68,68,0.15); color:#f87171; border:1px solid #f87171; }
        .badge-obligation { background:rgba(56,189,248,0.15); color:var(--primary); border:1px solid var(--primary); }
        .badge-indication { background:rgba(16,185,129,0.15); color:var(--success); border:1px solid var(--success); }
        .badge-priorite { background:rgba(245,158,11,0.15); color:var(--warning); border:1px solid var(--warning); }
        .badge-direction { background:rgba(168,85,247,0.15); color:#a855f7; border:1px solid #a855f7; }
        .badge-service { background:rgba(251,191,36,0.15); color:#fbbf24; border:1px solid #fbbf24; }
        .badge-panonceaux { background:rgba(148,163,184,0.2); color:var(--text-muted); border:1px solid var(--text-muted); }

        /* Quiz panneaux */
        .quiz-pann-card {
            background:var(--bg-deep); border-radius:10px;
            padding:1.25rem; margin-bottom:1rem; border:2px solid transparent;
        }
        .quiz-pann-card.correct { border-color:var(--success); }
        .quiz-pann-card.incorrect { border-color:var(--error); }
        .quiz-pann-q { font-size:0.95rem; font-weight:600; margin-bottom:1rem; }
        .quiz-pann-code { font-size:1.4rem; font-weight:800; color:var(--primary); margin-bottom:0.5rem; }
        .quiz-pann-opts { display:grid; grid-template-columns:1fr 1fr; gap:0.5rem; }
        @media(max-width:380px){ .quiz-pann-opts { grid-template-columns:1fr; } }
        .pann-opt {
            background:var(--bg-card); border:2px solid transparent;
            border-radius:8px; padding:0.6rem 0.75rem;
            font-size:0.8rem; cursor:pointer; transition:all 0.15s;
            text-align:left; color:var(--text);
        }
        .pann-opt:hover:not(.locked) { border-color:var(--green); }
        .pann-opt.selected { border-color:var(--primary); background:rgba(56,189,248,0.1); }
        .pann-opt.correct { border-color:var(--success); background:rgba(16,185,129,0.15); color:var(--success); }
        .pann-opt.incorrect { border-color:var(--error); background:rgba(239,68,68,0.1); color:var(--error); }
        .pann-opt.locked { cursor:default; }
        .quiz-pann-score {
            text-align:center; padding:1.5rem;
            font-size:1.2rem; font-weight:700;
        }
        .quiz-pann-feedback {
            font-size:0.8rem; margin-top:0.6rem; padding:0.5rem 0.75rem;
            border-radius:6px; display:none;
        }
        .quiz-pann-feedback.show { display:block; }
        .quiz-pann-feedback.ok { background:rgba(16,185,129,0.1); color:var(--success); }
        .quiz-pann-feedback.ko { background:rgba(239,68,68,0.1); color:var(--error); }
        .cat-tabs {
            display:flex; gap:0.4rem; flex-wrap:wrap; margin-bottom:1rem;
        }
        .cat-tab {
            padding:0.4rem 0.875rem; border-radius:20px; font-size:0.78rem;
            font-weight:600; cursor:pointer; border:2px solid transparent;
            background:var(--bg-deep); color:var(--text-muted); transition:all 0.2s;
        }
        .cat-tab.active { border-color:var(--green); color:var(--text); background:rgba(0,133,63,0.1); }
        .search-box {
            background:var(--bg-deep); border:2px solid rgba(255,255,255,0.1);
            border-radius:8px; padding:0.75rem 1rem; width:100%;
            color:var(--text); font-size:0.875rem; margin-bottom:0.875rem;
        }
        .search-box:focus { outline:none; border-color:var(--green); }
        .search-box::placeholder { color:var(--text-muted); }
        .panneaux-count { font-size:0.78rem; color:var(--text-muted); margin-bottom:0.75rem; }

    </style>
</head>
<body>

<header>
    <div class="flag">
        <div class="flag-g"></div>
        <div class="flag-y"><span class="flag-star">‚òÖ</span></div>
        <div class="flag-r"></div>
    </div>
    <div class="header-text">
        <h1>Code de la Route ‚Äì S√©n√©gal</h1>
        <p>Permis blanc ¬∑ Entra√Ænement B1 √† B12</p>
    </div>
</header>

<!-- ‚ïê‚ïê WELCOME ‚ïê‚ïê -->
<div class="screen active" id="screen-welcome">
    <div class="card" style="margin-top:1rem;">
        <div class="welcome-icon">üöó</div>
        <div class="welcome-title">Bienvenue candidat(e) !</div>
        <div class="welcome-sub">Pr√©parez-vous pour l'examen du permis de conduire au S√©n√©gal</div>
        <div class="info-box">
            <strong>üìã Crit√®res de r√©ussite :</strong>
            <ul>
                <li>25 questions par s√©rie</li>
                <li>Maximum <strong>6 erreurs</strong> autoris√©es</li>
                <li>Vous devez r√©pondre avant de passer √† la suivante</li>
                <li>Correction d√©taill√©e apr√®s chaque s√©rie</li>
            </ul>
        </div>
        <button class="btn" onclick="showScreen('screen-series')">Choisir une s√©rie ‚Üí</button>
        
    </div>
</div>

<!-- ‚ïê‚ïê SERIES ‚ïê‚ïê -->
<div class="screen" id="screen-series">
    <button class="back-btn" onclick="showScreen('screen-welcome')">‚Üê Accueil</button>
    
    <div class="card">
        <div class="series-title">Choisissez une s√©rie</div>
        <div class="series-sub">S√©lectionnez une des 12 s√©ries de 25 questions</div>
        <div class="series-grid" id="seriesGrid"></div>
    </div>
</div>

<!-- ‚ïê‚ïê QUIZ ‚ïê‚ïê -->
<div class="screen" id="screen-quiz">
    <div class="progress-bar"><div class="progress-fill" id="progressBar"></div></div>
    <div class="quiz-topbar">
        <div>
            <div class="quiz-serie" id="quizSerieName"></div>
            <div class="quiz-info">Question <span id="qNum">1</span> / 25</div>
        </div>
        <div class="timer" id="timer">00:00</div>
    </div>

    <div class="question-card">
        <img class="question-img" id="questionImg" src="" alt="" onerror="this.style.display='none'; document.getElementById('imgPlaceholder').style.display='block'">
        <div class="question-img-placeholder" id="imgPlaceholder" style="display:none">
            üìÑ Image non disponible ‚Äî placez les images dans le dossier <code>images/</code>
        </div>
        <div class="question-body">
            <div class="alert-answer" id="alertAnswer">‚ö†Ô∏è Veuillez s√©lectionner une r√©ponse avant de continuer</div>
            <div class="options-grid" id="optionsContainer"></div>
        </div>
    </div>

    <div class="quiz-actions">
        <button class="btn btn-outline btn-sm btn-prev" onclick="prevQuestion()">‚Üê Pr√©c.</button>
        <button class="btn" id="nextBtn" onclick="nextQuestion()">Suivant ‚Üí</button>
    </div>
</div>

<!-- ‚ïê‚ïê RESULTS ‚ïê‚ïê -->
<div class="screen" id="screen-results">
    <div class="card">
        <div class="result-header">
            <span class="result-badge" id="resultBadge"></span>
            <div class="result-verdict" id="resultVerdict"></div>
            <div class="result-serie" id="resultSerie"></div>
        </div>
        <div class="result-stats">
            <div class="stat-box">
                <div class="stat-val" style="color:var(--success)" id="statCorrect">0</div>
                <div class="stat-lbl">Correctes</div>
            </div>
            <div class="stat-box">
                <div class="stat-val" style="color:var(--error)" id="statWrong">0</div>
                <div class="stat-lbl">Erreurs</div>
            </div>
            <div class="stat-box">
                <div class="stat-val" style="color:var(--warning)" id="statTime">--</div>
                <div class="stat-lbl">Temps</div>
            </div>
        </div>
        <div class="btn-row">
            <button class="btn btn-outline" onclick="retryQuiz()">‚Ü∫ Recommencer</button>
            <button class="btn btn-outline" onclick="showScreen('screen-series')">‚ò∞ S√©ries</button>
        </div>
    </div>

    <!-- Tableau corrections -->
    <div class="card">
        <div class="correction-title">üìä Cliquez sur une question pour voir la correction</div>
        <div class="questions-grid" id="questionsGrid"></div>
    </div>
</div>

<!-- ‚ïê‚ïê MODAL CORRECTION ‚ïê‚ïê -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
    <div class="modal" id="modalContent">
        <div class="modal-header">
            <h3 id="modalTitle">Correction Q1</h3>
            <button class="modal-close" onclick="closeModalDirect()">‚úï</button>
        </div>
        <img class="modal-img" id="modalImg" src="" alt="">
        <div class="modal-options" id="modalOptions"></div>
        <div class="modal-legend">
            <span><span style="color:var(--success)">‚óè</span> Bonne r√©ponse</span>
            <span><span style="color:var(--error)">‚óè</span> Votre r√©ponse (incorrecte)</span>
        </div>
    </div>
</div>

<script>
// ‚îÄ‚îÄ DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const quizData = {
    B1: [{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]}],
    B2: [{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]}],
    B3: [{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]}],
    B4: [{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]}],
    B5: [{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]}],
    B6: [{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[2, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]}],
    B7: [{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[2, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[2, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]}],
    B8: [{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]}],
    B9: [{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]}],
    B10: [{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]}],
    B11: [{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[2, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]}],
    B12: [{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0, 3]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[0]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1, 2]},{o:["R√©ponse A","R√©ponse B","R√©ponse C","R√©ponse D"],a:[1]}]
};

// ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let state = {
    series: null, qIndex: 0,
    answers: [],   // tableau de [] par question
    locked: [],    // true quand r√©ponse valid√©e
    startTime: null, timerInterval: null,
    progress: JSON.parse(localStorage.getItem('quiz_progress') || '{}')
};

// ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    window.scrollTo(0,0);
}

// ‚îÄ‚îÄ SERIES GRID ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderSeriesGrid() {
    const grid = document.getElementById('seriesGrid');
    grid.innerHTML = '';
    Object.keys(quizData).forEach(s => {
        const btn = document.createElement('button');
        btn.className = 'series-btn' + (state.progress[s] ? ' done' : '');
        const p = state.progress[s];
        btn.innerHTML = s + (p ? `<span class="serie-score">${p.score}/25</span>` : '');
        btn.onclick = () => startQuiz(s);
        grid.appendChild(btn);
    });
}

// ‚îÄ‚îÄ START QUIZ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function startQuiz(series) {
    state.series = series;
    state.qIndex = 0;
    state.answers = Array.from({length:25}, () => []);
    state.locked  = new Array(25).fill(false);
    state.startTime = Date.now();

    document.getElementById('quizSerieName').textContent = 'S√©rie ' + series;
    clearInterval(state.timerInterval);
    state.timerInterval = setInterval(updateTimer, 1000);

    showScreen('screen-quiz');
    renderQuestion();
}

// ‚îÄ‚îÄ TIMER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateTimer() {
    const s = Math.floor((Date.now() - state.startTime) / 1000);
    const m = Math.floor(s/60), sec = s%60;
    document.getElementById('timer').textContent =
        String(m).padStart(2,'0') + ':' + String(sec).padStart(2,'0');
}

// ‚îÄ‚îÄ RENDER QUESTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderQuestion() {
    const i = state.qIndex;
    const q = quizData[state.series][i];
    const locked = state.locked[i];

    // Progress
    document.getElementById('progressBar').style.width = ((i+1)/25*100) + '%';
    document.getElementById('qNum').textContent = i+1;

    // Image
    const imgEl = document.getElementById('questionImg');
    const placeholder = document.getElementById('imgPlaceholder');
    const imgName = `${state.series}_Q${i+1}.jpg`;
    imgEl.src = `images/${imgName}`;
    imgEl.alt = `${state.series} Question ${i+1}`;
    imgEl.style.display = 'block';
    placeholder.style.display = 'none';

    // Alert reset
    document.getElementById('alertAnswer').classList.remove('show');

    // Options
    const container = document.getElementById('optionsContainer');
    container.innerHTML = '';
    q.o.forEach((opt, idx) => {
        const div = document.createElement('div');
        div.className = 'option';
        const selected = state.answers[i].includes(idx);
        const isCorrect = q.a.includes(idx);

        if (locked) {
            div.classList.add('locked');
            if (isCorrect) div.classList.add('correct');
            else if (selected && !isCorrect) div.classList.add('incorrect');
            else if (selected) div.classList.add('selected');
        } else {
            if (selected) div.classList.add('selected');
        }

        div.innerHTML = `
            <div class="opt-letter">${['A','B','C','D'][idx]}</div>
            <div class="opt-text">${opt}</div>
        `;
        if (!locked) div.onclick = () => toggleOption(idx);
        container.appendChild(div);
    });

    // Bouton suivant
    const nextBtn = document.getElementById('nextBtn');
    if (i === 24) {
        nextBtn.textContent = locked ? 'Voir les r√©sultats ‚Üí' : 'Valider & Terminer';
        nextBtn.onclick = locked ? finishQuiz : validateAndNext;
    } else {
        nextBtn.textContent = locked ? 'Suivant ‚Üí' : 'Valider ‚Üí';
        nextBtn.onclick = locked ? goNext : validateAndNext;
    }
}

// ‚îÄ‚îÄ TOGGLE OPTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toggleOption(idx) {
    const i = state.qIndex;
    const arr = state.answers[i];
    const pos = arr.indexOf(idx);
    if (pos > -1) arr.splice(pos, 1);
    else arr.push(idx);
    renderQuestion();
}

// ‚îÄ‚îÄ VALIDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function validateAndNext() {
    const i = state.qIndex;
    if (state.answers[i].length === 0) {
        document.getElementById('alertAnswer').classList.add('show');
        return;
    }
    state.locked[i] = true;
    renderQuestion();
}

function goNext() {
    if (state.qIndex < 24) { state.qIndex++; renderQuestion(); }
}

function prevQuestion() {
    if (state.qIndex > 0) { state.qIndex--; renderQuestion(); }
}

function nextQuestion() { /* handled by btn onclick */ }

// ‚îÄ‚îÄ FINISH ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function finishQuiz() {
    clearInterval(state.timerInterval);
    const total = Math.floor((Date.now() - state.startTime)/1000);
    const m = Math.floor(total/60), s = total%60;

    let correct = 0;
    quizData[state.series].forEach((q, i) => {
        const ua = state.answers[i].slice().sort();
        const ca = q.a.slice().sort();
        if (JSON.stringify(ua) === JSON.stringify(ca)) correct++;
    });
    const errors = 25 - correct;
    const admis = errors <= 6;

    // Sauvegarder
    state.progress[state.series] = { score: correct, admis };
    localStorage.setItem('quiz_progress', JSON.stringify(state.progress));

    // R√©sultats
    document.getElementById('resultBadge').textContent = admis ? 'üéâ' : 'üòî';
    document.getElementById('resultVerdict').textContent = admis ? 'ADMIS !' : 'AJOURN√â';
    document.getElementById('resultVerdict').className = 'result-verdict ' + (admis ? 'admis' : 'ajourn');
    document.getElementById('resultSerie').textContent =
        `S√©rie ${state.series} ¬∑ ${correct}/25 r√©ponses correctes ¬∑ ${errors} erreur(s)`;
    document.getElementById('statCorrect').textContent = correct;
    document.getElementById('statWrong').textContent = errors;
    document.getElementById('statTime').textContent =
        String(m).padStart(2,'0') + ':' + String(s).padStart(2,'0');

    // Grille corrections
    const grid = document.getElementById('questionsGrid');
    grid.innerHTML = '';
    quizData[state.series].forEach((q, i) => {
        const ua = state.answers[i].slice().sort();
        const ca = q.a.slice().sort();
        const ok = JSON.stringify(ua) === JSON.stringify(ca);
        const cell = document.createElement('div');
        cell.className = 'q-cell ' + (ok ? 'ok' : 'ko');
        cell.textContent = i+1;
        cell.title = `Question ${i+1} ‚Äì ${ok ? '‚úì Correct' : '‚úó Incorrect'}`;
        cell.onclick = () => openModal(i);
        grid.appendChild(cell);
    });

    showScreen('screen-results');
}

// ‚îÄ‚îÄ MODAL CORRECTION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openModal(qIndex) {
    const q = quizData[state.series][qIndex];
    const ua = state.answers[qIndex];
    const ca = q.a;

    document.getElementById('modalTitle').textContent =
        `Correction ‚Äî ${state.series} Q${qIndex+1}`;

    // Image
    const modalImg = document.getElementById('modalImg');
    modalImg.src = `images/${state.series}_Q${qIndex+1}.jpg`;
    modalImg.onerror = function() { this.style.display='none'; };
    modalImg.style.display = 'block';

    // Options
    const opts = document.getElementById('modalOptions');
    opts.innerHTML = '';
    q.o.forEach((opt, idx) => {
        const isCorrect = ca.includes(idx);
        const wasSelected = ua.includes(idx);
        let cls = 'neutral';
        if (isCorrect) cls = 'correct';
        else if (wasSelected && !isCorrect) cls = 'incorrect';

        const div = document.createElement('div');
        div.className = `modal-option ${cls}`;
        div.innerHTML = `
            <div class="modal-opt-letter">${['A','B','C','D'][idx]}</div>
            <div style="flex:1">${opt}</div>
            ${isCorrect ? '<span>‚úì</span>' : (wasSelected ? '<span>‚úó</span>' : '')}
        `;
        opts.appendChild(div);
    });

    document.getElementById('modalOverlay').classList.add('open');
}

function closeModal(e) {
    if (e.target === document.getElementById('modalOverlay')) closeModalDirect();
}
function closeModalDirect() {
    document.getElementById('modalOverlay').classList.remove('open');
}

// ‚îÄ‚îÄ RETRY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function retryQuiz() { startQuiz(state.series); }

// ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ





// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PANNEAUX DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var panneauxDB = {
  "Panneaux de Danger (A)": { badge:"badge-danger", emoji:"‚ö†Ô∏è", description:"Triangulaires, fond blanc, lis√©r√© rouge. Pr√©viennent d'un danger.", items:[
    {code:"A1a",def:"Virage dangereux √† droite"},
    {code:"A1b",def:"Virage dangereux √† gauche"},
    {code:"A1c",def:"Succession de virages, le premier √† droite"},
    {code:"A1d",def:"Succession de virages, le premier √† gauche"},
    {code:"A2a",def:"Cassis ou dos-d'√¢ne"},
    {code:"A2b",def:"Ralentisseur de type dos-d'√¢ne"},
    {code:"A3",def:"Chauss√©e r√©tr√©cie"},
    {code:"A3a",def:"Chauss√©e r√©tr√©cie par la droite"},
    {code:"A3b",def:"Chauss√©e r√©tr√©cie par la gauche"},
    {code:"A4",def:"Chauss√©e particuli√®rement glissante"},
    {code:"A6",def:"Pont mobile"},
    {code:"A7",def:"Passage √† niveau avec barri√®res √† fonctionnement manuel lors du passage des trains"},
    {code:"A8",def:"Passage √† niveau sans barri√®res ni demi-barri√®res"},
    {code:"A9",def:"Travers√©e de voies de tramways"},
    {code:"A13a",def:"Endroit fr√©quent√© par les enfants"},
    {code:"A13b",def:"Passage pour pi√©tons"},
    {code:"A14",def:"Autres dangers (nature pr√©cis√©e par panonceau)"},
    {code:"A15a1",def:"Passage d'animaux domestiques"},
    {code:"A15a2",def:"Passage d'animaux domestiques (variante)"},
    {code:"A15b",def:"Passage d'animaux sauvages"},
    {code:"A15c",def:"Passage de cavaliers"},
    {code:"A16",def:"Descente dangereuse"},
    {code:"A17",def:"Annonce de feux tricolores"},
    {code:"A18",def:"Circulation dans les deux sens"},
    {code:"A19",def:"Risque de chute de pierres ou pr√©sence de pierres tomb√©es sur la route"},
    {code:"A20",def:"D√©bouch√© sur un quai ou une berge"},
    {code:"A21",def:"D√©bouch√© de cyclistes venant de droite ou de gauche"},
    {code:"A23",def:"Travers√©e d'une aire de danger a√©rien"},
    {code:"A24",def:"Vent lat√©ral"}
  ]},
  "Signalisation Temporaire de Danger (AK)": { badge:"badge-danger", emoji:"üöß", description:"Signaux temporaires de chantier et obstacles temporaires.", items:[
    {code:"AK2",def:"Cassis, dos d'√¢ne (temporaire)"},
    {code:"AK3",def:"Chauss√©e r√©tr√©cie (temporaire)"},
    {code:"AK4",def:"Chauss√©e glissante (temporaire)"},
    {code:"AK5",def:"Travaux ‚Äî imposer prudence et adaptation de la vitesse"},
    {code:"AK14",def:"Autres dangers temporaires (nature pr√©cis√©e par inscription)"},
    {code:"AK17",def:"Annonce de signaux lumineux r√©glant la circulation"},
    {code:"AK22",def:"Projection de gravillons"},
    {code:"AK30",def:"Bouchon"},
    {code:"AK31",def:"Accident"}
  ]},
  "Panneaux de Priorit√© (AB)": { badge:"badge-priorite", emoji:"‚öñÔ∏è", description:"R√®glent les priorit√©s aux intersections.", items:[
    {code:"AB1",def:"Intersection o√π le conducteur doit c√©der le passage aux v√©hicules venant de sa droite"},
    {code:"AB2",def:"Intersection avec route dont les usagers doivent c√©der le passage (quand AB6 ne peut √™tre utilis√©)"},
    {code:"AB3a",def:"C√©dez le passage √† l'intersection ‚Äî signal de position"},
    {code:"AB3b",def:"C√©dez le passage √† l'intersection ‚Äî signal avanc√©"},
    {code:"AB4",def:"STOP ‚Äî arr√™t obligatoire √† l'intersection (signal de position)"},
    {code:"AB5",def:"STOP ‚Äî signal avanc√© du AB4"},
    {code:"AB6",def:"Indication du caract√®re prioritaire d'une route"},
    {code:"AB7",def:"Fin du caract√®re prioritaire d'une route"},
    {code:"AB25",def:"Carrefour √† sens giratoire ‚Äî priorit√© aux v√©hicules engag√©s dans le giratoire"}
  ]},
  "Panneaux d'Interdiction (B)": { badge:"badge-interdiction", emoji:"üö´", description:"Ronds, fond blanc, lis√©r√© rouge. Imposent une interdiction.", items:[
    {code:"B0",def:"Circulation interdite √† tout v√©hicule dans les deux sens"},
    {code:"B1",def:"Sens interdit √† tout v√©hicule"},
    {code:"B2a",def:"Interdiction de tourner √† gauche √† la prochaine intersection"},
    {code:"B2b",def:"Interdiction de tourner √† droite √† la prochaine intersection"},
    {code:"B2c",def:"Interdiction de faire demi-tour sur la route suivie jusqu'√† la prochaine intersection"},
    {code:"B3",def:"Interdiction de d√©passer tous les v√©hicules √† moteur (sauf deux roues sans side-car)"},
    {code:"B3a",def:"Interdiction de d√©passer pour poids lourds > 3,5 tonnes"},
    {code:"B4",def:"Arr√™t au poste de douane"},
    {code:"B5a",def:"Arr√™t au poste de gendarmerie"},
    {code:"B5b",def:"Arr√™t au poste de police"},
    {code:"B5c",def:"Arr√™t au poste de p√©age"},
    {code:"B6a1",def:"Stationnement interdit"},
    {code:"B6a2",def:"Stationnement interdit du 1er au 15 du mois"},
    {code:"B6a3",def:"Stationnement interdit du 16 √† la fin du mois"},
    {code:"B6b1",def:"Entr√©e d'une zone √† stationnement interdit"},
    {code:"B6b2",def:"Entr√©e d'une zone √† stationnement unilat√©ral √† alternance semi-mensuelle"},
    {code:"B6b3",def:"Entr√©e d'une zone √† stationnement de dur√©e limit√©e avec contr√¥le par disque"},
    {code:"B6b4",def:"Entr√©e d'une zone √† stationnement payant"},
    {code:"B6b5",def:"Entr√©e d'une zone √† stationnement unilat√©ral √† alternance semi-mensuelle et dur√©e limit√©e"},
    {code:"B6d",def:"Arr√™t et stationnement interdits"},
    {code:"B7a",def:"Acc√®s interdit aux v√©hicules √† moteur (sauf cyclomoteurs)"},
    {code:"B7b",def:"Acc√®s interdit √† tous les v√©hicules √† moteur"},
    {code:"B8",def:"Acc√®s interdit aux v√©hicules affect√©s au transport de marchandises"},
    {code:"B9a",def:"Acc√®s interdit aux pi√©tons"},
    {code:"B9b",def:"Acc√®s interdit aux cycles"},
    {code:"B9c",def:"Acc√®s interdit aux v√©hicules √† traction animale"},
    {code:"B9d",def:"Acc√®s interdit aux v√©hicules agricoles √† moteur"},
    {code:"B9e",def:"Acc√®s interdit aux voitures √† bras"},
    {code:"B9f",def:"Acc√®s interdit aux v√©hicules de transport en commun"},
    {code:"B9g",def:"Acc√®s interdit aux cyclomoteurs"},
    {code:"B9h",def:"Acc√®s interdit aux motocyclettes et motocyclettes l√©g√®res"},
    {code:"B9i",def:"Acc√®s interdit aux v√©hicules tractant une caravane ou remorque > 250 kg (PTRA <= 3,5t)"},
    {code:"B10a",def:"Acc√®s interdit aux v√©hicules dont la longueur d√©passe le nombre indiqu√©"},
    {code:"B11",def:"Acc√®s interdit si la largeur (chargement compris) d√©passe le nombre indiqu√©"},
    {code:"B12",def:"Acc√®s interdit si la hauteur (chargement compris) d√©passe le nombre indiqu√©"},
    {code:"B13",def:"Acc√®s interdit si le poids total autoris√© en charge d√©passe le nombre indiqu√©"},
    {code:"B13a",def:"Acc√®s interdit aux v√©hicules pesant sur un essieu plus que le nombre indiqu√©"},
    {code:"B14",def:"Limitation de vitesse ‚Äî interdiction de d√©passer la vitesse indiqu√©e"},
    {code:"B15",def:"C√©der le passage √† la circulation venant en sens inverse"},
    {code:"B16",def:"Signaux sonores interdits (klaxon interdit)"},
    {code:"B17",def:"Interdiction de circuler sans maintenir un intervalle minimum entre les v√©hicules"},
    {code:"B18a",def:"Acc√®s interdit aux v√©hicules transportant des marchandises explosives ou inflammables"},
    {code:"B18b",def:"Acc√®s interdit aux v√©hicules transportant des marchandises susceptibles de polluer les eaux"},
    {code:"B18c",def:"Acc√®s interdit aux v√©hicules transportant des marchandises dangereuses"},
    {code:"B19",def:"Autres interdictions (nature indiqu√©e par inscription sur le panneau)"},
    {code:"B30",def:"Entr√©e d'une zone √† vitesse limit√©e √† 30 km/h"},
    {code:"B52",def:"Entr√©e d'une zone de rencontre"}
  ]},
  "Panneaux d'Obligation (B21/B22)": { badge:"badge-obligation", emoji:"üîµ", description:"Ronds, fond bleu. Imposent une obligation de direction ou de comportement.", items:[
    {code:"B21-1",def:"Obligation de tourner √† droite avant le panneau"},
    {code:"B21-2",def:"Obligation de tourner √† gauche avant le panneau"},
    {code:"B21a1",def:"Contournement obligatoire par la droite"},
    {code:"B21a2",def:"Contournement obligatoire par la gauche"},
    {code:"B21b",def:"Direction obligatoire √† la prochaine intersection : tout droit"},
    {code:"B21c1",def:"Direction obligatoire √† la prochaine intersection : √† droite"},
    {code:"B21c2",def:"Direction obligatoire √† la prochaine intersection : √† gauche"},
    {code:"B21d1",def:"Directions obligatoires : tout droit ou √† droite"},
    {code:"B21d2",def:"Directions obligatoires : tout droit ou √† gauche"},
    {code:"B21e",def:"Directions obligatoires : √† droite ou √† gauche"},
    {code:"B22a",def:"Piste ou bande obligatoire pour les cycles sans side-car ni remorque"},
    {code:"B22b",def:"Chemin obligatoire pour pi√©tons"},
    {code:"B22c",def:"Chemin obligatoire pour cavaliers"},
    {code:"B25",def:"Vitesse minimale obligatoire"},
    {code:"B26",def:"Cha√Ænes √† neige obligatoires sur au moins deux roues motrices"},
    {code:"B27a",def:"Voie r√©serv√©e aux v√©hicules des services r√©guliers de transport en commun"},
    {code:"B27b",def:"Voie r√©serv√©e aux tramways"},
    {code:"B29",def:"Autres obligations (nature mentionn√©e par inscription sur le panneau)"}
  ]},
  "Fin d'Interdiction / Obligation (B31-B53)": { badge:"badge-indication", emoji:"‚úÖ", description:"Signalent la fin d'une prescription pr√©c√©dente impos√©e aux v√©hicules.", items:[
    {code:"B31",def:"Fin de toutes les interdictions pr√©c√©demment signal√©es impos√©es aux v√©hicules en mouvement"},
    {code:"B33",def:"Fin de limitation de vitesse"},
    {code:"B34",def:"Fin d'interdiction de d√©passer notifi√©e par le panneau B3"},
    {code:"B34a",def:"Fin d'interdiction de d√©passer pour poids lourds (B3a)"},
    {code:"B35",def:"Fin d'interdiction de l'usage de l'avertisseur sonore"},
    {code:"B39",def:"Fin d'interdiction (nature indiqu√©e sur le panneau)"},
    {code:"B40",def:"Fin de piste ou bande obligatoire pour cycles"},
    {code:"B41",def:"Fin de chemin obligatoire pour pi√©tons"},
    {code:"B42",def:"Fin de chemin obligatoire pour cavaliers"},
    {code:"B43",def:"Fin de vitesse minimale obligatoire"},
    {code:"B44",def:"Fin d'obligation de l'usage des cha√Ænes √† neige"},
    {code:"B45",def:"Fin de voie r√©serv√©e aux transports en commun"},
    {code:"B49",def:"Fin d'obligation (nature mentionn√©e par inscription)"},
    {code:"B50a",def:"Sortie de zone √† stationnement interdit"},
    {code:"B50b",def:"Sortie de zone √† stationnement unilat√©ral √† alternance semi-mensuelle"},
    {code:"B50c",def:"Sortie de zone √† stationnement de dur√©e limit√©e avec contr√¥le par disque"},
    {code:"B50d",def:"Sortie de zone √† stationnement payant"},
    {code:"B50e",def:"Sortie de zone √† stationnement unilat√©ral √† alternance semi-mensuelle et dur√©e limit√©e"},
    {code:"B51",def:"Sortie d'une zone √† vitesse limit√©e √† 30 km/h"},
    {code:"B53",def:"Sortie d'une zone de rencontre"},
    {code:"B54",def:"Entr√©e d'aire pi√©tonne"},
    {code:"B55",def:"Sortie d'aire pi√©tonne"}
  ]},
  "Panneaux d'Indication (C)": { badge:"badge-indication", emoji:"üü¶", description:"Fond bleu ou blanc. Informent sans interdire ni obliger.", items:[
    {code:"C1a",def:"Lieu am√©nag√© pour le stationnement"},
    {code:"C1b",def:"Lieu am√©nag√© pour le stationnement gratuit √† dur√©e limit√©e avec contr√¥le par disque"},
    {code:"C1c",def:"Lieu am√©nag√© pour le stationnement payant"},
    {code:"C3",def:"Risque d'incendie"},
    {code:"C4a",def:"Vitesse conseill√©e ‚Äî vitesse √† laquelle il est conseill√© de circuler si les circonstances le permettent"},
    {code:"C4b",def:"Fin de vitesse conseill√©e"},
    {code:"C5",def:"Station de taxis ‚Äî arr√™t et stationnement r√©serv√©s aux taxis en service"},
    {code:"C6",def:"Arr√™t d'autobus ‚Äî arr√™t et stationnement des autres v√©hicules interdits"},
    {code:"C8",def:"Emplacement d'arr√™t d'urgence ‚Äî r√©serv√© aux arr√™ts d'urgence"},
    {code:"C12",def:"Circulation √† sens unique"},
    {code:"C13a",def:"Impasse"},
    {code:"C13b",def:"Pr√©signalisation d'une impasse"},
    {code:"C14",def:"Pr√©signalisation de la praticabilit√© d'une section de route (ouverte ou ferm√©e)"},
    {code:"C18",def:"Priorit√© par rapport √† la circulation venant en sens inverse"},
    {code:"C20a",def:"Passage pour pi√©tons"},
    {code:"C20c",def:"Travers√©e de tramways"},
    {code:"C23",def:"Stationnement r√©glement√© pour caravanes et autocaravanes"},
    {code:"C24a",def:"Conditions particuli√®res de circulation par voie sur la route suivie"},
    {code:"C24b",def:"Voies affect√©es √† l'approche d'une intersection"},
    {code:"C24c",def:"Conditions particuli√®res de circulation sur la route ou voie embranch√©e"},
    {code:"C25a",def:"Indication aux fronti√®res des limites de vitesse sur le territoire fran√ßais"},
    {code:"C25b",def:"Rappel des limites de vitesse sur autoroute"},
    {code:"C26a",def:"Voie de d√©tresse √† droite"},
    {code:"C26b",def:"Voie de d√©tresse √† gauche"},
    {code:"C27",def:"Sur√©l√©vation de chauss√©e (ralentisseur)"},
    {code:"C28",def:"R√©duction du nombre de voies sur une route √† chauss√©es s√©par√©es"},
    {code:"C29a",def:"Pr√©signalisation d'un cr√©neau de d√©passement ou section √† chauss√©es s√©par√©es"},
    {code:"C29b",def:"Cr√©neau de d√©passement √† trois voies ‚Äî deux voies dans un sens, une dans l'autre"},
    {code:"C29c",def:"Section √† trois voies ‚Äî une voie dans un sens, deux dans l'autre"},
    {code:"C30",def:"Fin d'un cr√©neau de d√©passement √† trois voies"},
    {code:"C50",def:"Indications diverses"},
    {code:"C62",def:"Pr√©signalisation d'une borne de retrait de ticket de p√©age"},
    {code:"C64a",def:"Paiement aupr√®s d'un p√©agiste"},
    {code:"C64b",def:"Paiement par carte bancaire"},
    {code:"C64c",def:"Paiement automatique par pi√®ces de monnaie"},
    {code:"C64d",def:"Paiement par abonnement ‚Äî voie r√©serv√©e aux usagers abonn√©s"},
    {code:"C107",def:"Route √† acc√®s r√©glement√© ‚Äî vitesse max 110 km/h, r√®gles autoroute applicables"},
    {code:"C108",def:"Fin de route √† acc√®s r√©glement√©"},
    {code:"C111",def:"Entr√©e d'un tunnel ‚Äî feux de croisement obligatoires, demi-tour et arr√™t interdits"},
    {code:"C112",def:"Sortie de tunnel ‚Äî fin des prescriptions du C111"},
    {code:"C113",def:"Piste ou bande cyclable conseill√©e et r√©serv√©e aux cycles √† deux ou trois roues"},
    {code:"C114",def:"Fin d'une piste ou bande cyclable conseill√©e"},
    {code:"C115",def:"Voie verte ‚Äî r√©serv√©e √† la circulation des pi√©tons et v√©hicules non motoris√©s"},
    {code:"C116",def:"Fin de voie verte"},
    {code:"C117",def:"Pr√©signalisation d'un tunnel dont l'acc√®s est interdit √† certains v√©hicules dangereux"},
    {code:"C207",def:"D√©but d'une section d'autoroute ‚Äî d√©but des r√®gles particuli√®res autoroute"},
    {code:"C208",def:"Fin d'une section d'autoroute ‚Äî fin des r√®gles particuli√®res autoroute"}
  ]},
  "Panneaux de Services (CE)": { badge:"badge-service", emoji:"üè•", description:"Signalent des √©quipements et services disponibles sur l'itin√©raire.", items:[
    {code:"CE1",def:"Poste de secours"},
    {code:"CE2a",def:"Poste d'appel d'urgence"},
    {code:"CE2b",def:"Cabine t√©l√©phonique publique"},
    {code:"CE3a",def:"Informations relatives aux services ou activit√©s touristiques"},
    {code:"CE3b",def:"Panneau d'information service ‚Äî relais d'information service"},
    {code:"CE4a",def:"Terrain de camping pour tentes"},
    {code:"CE4b",def:"Terrain de camping pour caravanes et autocaravanes"},
    {code:"CE4c",def:"Terrain de camping pour tentes, caravanes et autocaravanes"},
    {code:"CE5a",def:"Auberge de jeunesse"},
    {code:"CE5b",def:"Chambre d'h√¥tes ou g√Æte"},
    {code:"CE6a",def:"Point de d√©part d'un itin√©raire p√©destre"},
    {code:"CE6b",def:"Point de d√©part d'un circuit de ski de fond"},
    {code:"CE7",def:"Emplacement pour pique-nique"},
    {code:"CE8",def:"Gare auto / train"},
    {code:"CE10",def:"Embarcad√®re"},
    {code:"CE12",def:"Toilettes ouvertes au public"},
    {code:"CE14",def:"Installations accessibles aux personnes handicap√©es √† mobilit√© r√©duite"},
    {code:"CE15a",def:"Poste de distribution de carburant ouvert 7j/7 et 24h/24"},
    {code:"CE15c",def:"Poste de carburant 7j/7 24h/24 assurant le ravitaillement en GPL"},
    {code:"CE16",def:"Restaurant ouvert 7 jours sur 7"},
    {code:"CE17",def:"H√¥tel ou motel ouvert 7 jours sur 7"},
    {code:"CE18",def:"D√©bit de boissons ou √©tablissement proposant des collations sommaires, ouvert 7j/7"},
    {code:"CE19",def:"Emplacement de mise √† l'eau d'embarcations l√©g√®res"},
    {code:"CE20a",def:"Gare de t√©l√©ph√©rique"},
    {code:"CE20b",def:"Point de d√©part d'un t√©l√©si√®ge ou t√©l√©cabine"},
    {code:"CE21",def:"Point de vue"},
    {code:"CE22",def:"Fr√©quence d'√©mission d'une station radio d√©di√©e aux infos circulation"},
    {code:"CE23",def:"Jeux d'enfants"},
    {code:"CE24",def:"Station de vidange pour caravanes, autocaravanes et cars"},
    {code:"CE25",def:"Distributeur de billets de banque"},
    {code:"CE26",def:"Station de gonflage gratuite hors station service"},
    {code:"CE27",def:"Point de d√©tente"},
    {code:"CE28",def:"Poste de d√©pannage"},
    {code:"CE29",def:"Moyen de lutte contre l'incendie"},
    {code:"CE30a",def:"Issue de secours vers la droite"},
    {code:"CE30b",def:"Issue de secours vers la gauche"},
    {code:"CE50",def:"Installations ou services divers"}
  ]},
  "Panonceaux (M)": { badge:"badge-panonceaux", emoji:"üìå", description:"Compl√®tent et pr√©cisent la port√©e d'un panneau principal.", items:[
    {code:"M1",def:"Longueur de la section comprise entre le signal et le d√©but du passage dangereux ou de la zone r√©glement√©e"},
    {code:"M1a",def:"Marque du distributeur de carburant et distance jusqu'au prochain poste sur autoroute"},
    {code:"M2",def:"Longueur de la section dangereuse ou soumise √† r√©glementation"},
    {code:"M3a",def:"Position de la voie concern√©e par le panneau qu'il compl√®te"},
    {code:"M3b",def:"Direction √† suivre (et distance) pour rencontrer le service indiqu√©"},
    {code:"M3d",def:"Le panneau qu'il compl√®te se rapporte √† la voie au-dessus de laquelle il est implant√©"},
    {code:"M4a",def:"D√©signe les v√©hicules dont le PTAC est inf√©rieur √† 3,5 tonnes"},
    {code:"M4b",def:"D√©signe les v√©hicules de transport en commun de personnes"},
    {code:"M4c",def:"D√©signe les motocyclettes et motocyclettes l√©g√®res"},
    {code:"M4d1",def:"D√©signe les cycles (v√©los)"},
    {code:"M4d2",def:"D√©signe les cyclomoteurs"},
    {code:"M4e",def:"D√©signe par l'inscription les usagers concern√©s"},
    {code:"M4f",def:"D√©signe les v√©hicules dont le PTAC exc√®de le nombre indiqu√©"},
    {code:"M4g",def:"D√©signe les v√©hicules affect√©s au transport de marchandises"},
    {code:"M4h",def:"D√©signe les poids lourds de transport de marchandises d√©passant le tonnage indiqu√©"},
    {code:"M4i",def:"D√©signe les v√©hicules agricoles √† moteur"},
    {code:"M4j",def:"D√©signe les v√©hicules √©quip√©s de cha√Ænes √† neige"},
    {code:"M4k",def:"D√©signe les v√©hicules transportant des marchandises explosives ou inflammables"},
    {code:"M4l",def:"D√©signe les v√©hicules transportant des marchandises polluant les eaux"},
    {code:"M4m",def:"D√©signe les v√©hicules transportant des marchandises dangereuses"},
    {code:"M4n",def:"D√©signe les installations am√©nag√©es pour handicap√©s physiques"},
    {code:"M4p",def:"D√©signe les pi√©tons"},
    {code:"M4q",def:"D√©signe les v√©hicules dont la longueur est sup√©rieure au nombre indiqu√©"},
    {code:"M4r",def:"D√©signe les v√©hicules pesant sur un essieu plus que le nombre indiqu√©"},
    {code:"M4s",def:"D√©signe les v√©hicules √† traction animale"},
    {code:"M4t",def:"D√©signe les charrettes √† bras"},
    {code:"M4u",def:"D√©signe les v√©hicules dont la largeur (chargement compris) est sup√©rieure au nombre indiqu√©"},
    {code:"M4v",def:"D√©signe les v√©hicules dont la hauteur (chargement compris) est sup√©rieure au nombre indiqu√©"},
    {code:"M4w",def:"D√©signe les v√©hicules tractant une remorque dont le PTAC d√©passe 250 kg"},
    {code:"M4x",def:"D√©signe les v√©hicules tractant une caravane/remorque > 250 kg avec PTRC <= 3,5t"},
    {code:"M4y",def:"D√©signe les cavaliers"},
    {code:"M4z",def:"Indique la cat√©gorie d'un tunnel concernant les marchandises dangereuses"},
    {code:"M5",def:"Distance entre le signal et l'endroit o√π le conducteur doit marquer l'arr√™t et c√©der le passage"},
    {code:"M6a",def:"Stationnement g√™nant ‚Äî v√©hicule susceptible de mise en fourri√®re"},
    {code:"M6b",def:"Stationnement unilat√©ral √† alternance semi-mensuelle"},
    {code:"M6c",def:"Dur√©e maximum du stationnement avec contr√¥le par disque"},
    {code:"M6d",def:"Stationnement payant avec parcm√®tre"},
    {code:"M6e",def:"Stationnement payant sans parcm√®tre"},
    {code:"M6f",def:"Pr√©cisions concernant l'interdiction"},
    {code:"M6g",def:"Indications diverses ne concernant pas les interdictions"},
    {code:"M6h",def:"Stationnement r√©serv√© aux personnes handicap√©es √† mobilit√© r√©duite"},
    {code:"M6i",def:"Stationnement r√©serv√© aux v√©hicules √©lectriques pendant la recharge"},
    {code:"M7",def:"Panonceau sch√©ma ‚Äî repr√©sente l'intersection √† venir et indique les branches prioritaires"},
    {code:"M8a",def:"La prescription s'√©tend apr√®s le panneau (d√©but de section)"},
    {code:"M8b",def:"La prescription s'√©tend avant le panneau (fin de section)"},
    {code:"M8c",def:"La prescription s'√©tend de part et d'autre du panneau (rappel)"},
    {code:"M8d",def:"La prescription s'√©tend dans les sens indiqu√©s par les fl√®ches"},
    {code:"M8e",def:"La prescription s'√©tend dans les sens indiqu√©s par les fl√®ches (variante)"},
    {code:"M8f",def:"La prescription s'√©tend dans les sens indiqu√©s par les fl√®ches (variante)"},
    {code:"M9a",def:"Le panneau associ√© concerne une aire de danger a√©rien"},
    {code:"M9b",def:"Au passage √† niveau, la voie ferr√©e est √©lectrifi√©e"},
    {code:"M9c",def:"C√©dez le passage"},
    {code:"M9d",def:"Le passage pour pi√©tons est sur√©lev√©"},
    {code:"M9e",def:"L'emplacement d'arr√™t d'urgence est dot√© d'un poste d'appel d'urgence"},
    {code:"M9f",def:"L'emplacement d'arr√™t d'urgence est dot√© d'un poste d'appel et d'un moyen de lutte contre l'incendie"},
    {code:"M9j1",def:"Indique le risque de heurt de v√©hicules lents"},
    {code:"M9j2",def:"Indique le risque de heurt de v√©hicules lents (variante)"},
    {code:"M9v1",def:"La prescription du panneau associ√© ne s'applique pas aux cyclistes"},
    {code:"M9v2",def:"La prescription du panneau associ√© ne s'applique pas aux cyclistes (variante)"},
    {code:"M9z",def:"Indications diverses par inscriptions"},
    {code:"M10a",def:"Indique le num√©ro d'une route ou d'une autoroute"},
    {code:"M10b",def:"Indique le num√©ro d'un √©changeur"},
    {code:"M10c",def:"Indique l'acc√®s √† une rocade"},
    {code:"M10z",def:"Indique le nom propre d'un site ou de certains services"},
    {code:"M11a",def:"Signale les d√©rogations aux prescriptions d'une route √† acc√®s r√©glement√©"},
    {code:"M11b",def:"Panonceau signalant des d√©rogations ou des prescriptions"}
  ]},
  "Signalisation Directionnelle (D)": { badge:"badge-direction", emoji:"üó∫Ô∏è", description:"Jalonnement, pr√©signalisation et panneaux de direction.", items:[
    {code:"D21a",def:"Panneau de position comportant une indication de distance"},
    {code:"D21b",def:"Panneau de position ne comportant pas d'indication de distance"},
    {code:"D29",def:"Panneau de position signalant les lieux-dits et fermes"},
    {code:"D31b",def:"Panneau de signalisation avanc√©e de sortie non num√©rot√©e"},
    {code:"D31d",def:"Panneau de signalisation avanc√©e de sortie num√©rot√©e"},
    {code:"D31e",def:"Panneau de signalisation avanc√©e de sortie non num√©rot√©e (variante)"},
    {code:"D31f",def:"Panneau de signalisation avanc√©e de bifurcation autorouti√®re"},
    {code:"D32a",def:"Panneau de signalisation avanc√©e d'aire sur route"},
    {code:"D32b",def:"Panneau de signalisation avanc√©e d'aire sur autoroute"},
    {code:"D41a",def:"Panneau de pr√©signalisation de sortie num√©rot√©e"},
    {code:"D41b",def:"Panneau de pr√©signalisation de sortie non num√©rot√©e"},
    {code:"D41c",def:"Panneau de pr√©signalisation de bifurcation autorouti√®re"},
    {code:"D42a",def:"Panneau de pr√©signalisation diagrammatique des carrefours complexes"},
    {code:"D42b",def:"Panneau de pr√©signalisation diagrammatique √† sens giratoire"},
    {code:"D43",def:"Panneau de pr√©signalisation courante des carrefours"},
    {code:"D44",def:"Panneau de pr√©signalisation d'un village √©tape"},
    {code:"D45",def:"Panneau de pr√©signalisation √† 20 km environ d'un village √©tape"},
    {code:"D46",def:"Pr√©signalisation d'une aire de service ou de repos sur autoroute"},
    {code:"D47a",def:"Pr√©signalisation du d√©but d'une section √† p√©age"},
    {code:"D47b",def:"Pr√©signalisation d'une gare de p√©age (retrait ticket ou paiement)"},
    {code:"D47c",def:"Pr√©signalisation du paiement du p√©age"},
    {code:"D61a",def:"Panneau de confirmation courante utilis√© sur route"},
    {code:"D61b",def:"Panneau de confirmation courante utilis√© sur autoroute"},
    {code:"D62a",def:"Panneau de confirmation de filante utilis√© sur route √† chauss√©es s√©par√©es"},
    {code:"D62b",def:"Panneau de confirmation de filante utilis√© sur autoroute"},
    {code:"D71",def:"Panneau de signalisation compl√©mentaire de sortie"},
    {code:"D72b",def:"Panneau de signalisation compl√©mentaire des diff√©rentes sorties d'une agglom√©ration"},
    {code:"D73",def:"Panneau de pr√©signalisation compl√©mentaire de sortie"},
    {code:"Dv11",def:"Panneau compl√©mentaire d'identification d'un itin√©raire cyclable"},
    {code:"Dv12",def:"Panneau compl√©mentaire de d√©nomination d'un itin√©raire cyclable"},
    {code:"Dv21a",def:"Panneau de position cyclable avec indication de destination et distance"},
    {code:"Dv21b",def:"Panneau de position cyclable avec indication de destination"},
    {code:"Dv43a",def:"Panneau de pr√©signalisation courante cyclable avec destination et distance"},
    {code:"Dv43b",def:"Panneau de pr√©signalisation courante cyclable avec destination"},
    {code:"Dv43c",def:"Panneau de pr√©signalisation courante cyclable sans destination ni distance"},
    {code:"Dv61",def:"Panneau de confirmation courante cyclable"}
  ]},
  "Signaux d'Agglom√©ration (EB)": { badge:"badge-indication", emoji:"üèôÔ∏è", description:"Signalent l'entr√©e et la sortie des agglom√©rations.", items:[
    {code:"EB10",def:"Panneau d'entr√©e d'agglom√©ration ‚Äî la limitation √† 50 km/h s'applique automatiquement"},
    {code:"EB20",def:"Panneau de sortie d'agglom√©ration ‚Äî fin de la limitation √† 50 km/h de l'agglom√©ration"}
  ]},
  "Signalisation Sp√©ciale (SI/SC)": { badge:"badge-priorite", emoji:"üöõ", description:"Directions interdites ou conseill√©es pour certains types de v√©hicules.", items:[
    {code:"SI1a",def:"Signalisation avanc√©e d'une direction interdite aux v√©hicules de transport de marchandises"},
    {code:"SI1b",def:"Direction interdite aux poids lourds d√©passant le tonnage indiqu√©"},
    {code:"SI2",def:"Direction interdite aux cycles"},
    {code:"SI3",def:"Direction interdite aux v√©hicules de transport en commun"},
    {code:"SI4",def:"Direction interdite aux cyclomoteurs"},
    {code:"SI5",def:"Direction interdite aux v√©hicules de transport de marchandises d√©passant la longueur indiqu√©e"},
    {code:"SI6",def:"Direction interdite aux v√©hicules d√©passant la largeur indiqu√©e"},
    {code:"SI7",def:"Direction interdite aux v√©hicules d√©passant la hauteur indiqu√©e"},
    {code:"SI8",def:"Direction interdite aux v√©hicules d√©passant le tonnage indiqu√©"},
    {code:"SI9",def:"Direction interdite aux v√©hicules pesant sur un essieu plus que le nombre indiqu√©"},
    {code:"SI10",def:"Direction interdite aux v√©hicules transportant des marchandises explosives ou inflammables"},
    {code:"SI11",def:"Direction interdite aux v√©hicules transportant des marchandises polluant les eaux"},
    {code:"SI12",def:"Direction interdite aux v√©hicules transportant des marchandises dangereuses"},
    {code:"SI13",def:"Direction interdite aux motocyclettes et motocyclettes l√©g√®res"},
    {code:"SI14",def:"Direction interdite aux v√©hicules tractant une caravane ou remorque > 250 kg"},
    {code:"SC1a",def:"Direction conseill√©e aux v√©hicules de transport de marchandises"},
    {code:"SC2",def:"Direction conseill√©e aux cycles"},
    {code:"SC3",def:"Direction conseill√©e aux v√©hicules de transport en commun"},
    {code:"SC4",def:"Direction conseill√©e aux cyclomoteurs"},
    {code:"SC13",def:"Direction conseill√©e aux motocyclettes et motocyclettes l√©g√®res"},
    {code:"SC20",def:"Direction permettant d'indiquer l'itin√©raire Bis"}
  ]},
  "Signaux Lumineux (R)": { badge:"badge-service", emoji:"üö¶", description:"Feux et signaux lumineux de circulation.", items:[
    {code:"R1",def:"Feux de balisage et d'alerte ‚Äî compl√®tent la signalisation permanente de danger (orange fixe)"},
    {code:"R2",def:"Feux de balisage et d'alerte ‚Äî compl√®tent la signalisation temporaire (orange clignotant)"},
    {code:"R2d",def:"Feux de balisage √† d√©filement ‚Äî s'allument successivement pour indiquer une direction"},
    {code:"R12",def:"Signaux bicolores destin√©s aux pi√©tons (rouge/vert)"},
    {code:"R13b",def:"Signaux tricolores modaux pour services r√©guliers de transport en commun"},
    {code:"R13c",def:"Signaux tricolores modaux pour cyclistes"},
    {code:"R14",def:"Signaux tricolores directionnels ‚Äî autorisent ou interdisent un mouvement pr√©cis"},
    {code:"R15b",def:"Signaux d'anticipation modaux pour bus"},
    {code:"R15c",def:"Signaux d'anticipation modaux pour cycle"},
    {code:"R16",def:"Signaux d'anticipation directionnels"},
    {code:"R17",def:"Signaux pour tramways"},
    {code:"R18",def:"Signaux directionnels pour tramways"},
    {code:"R21a",def:"Signal d'affectation de voies ‚Äî interdiction d'emprunter la voie (croix rouge)"},
    {code:"R21b",def:"Signal d'affectation de voies ‚Äî autorisation d'emprunter la voie (fl√®che verte)"},
    {code:"R21c",def:"Signal d'affectation de voies ‚Äî obligation de se rabattre vers la voie indiqu√©e"},
    {code:"R22",def:"Signaux tricolores de contr√¥le de flot"},
    {code:"R23",def:"Signaux bicolores de contr√¥le individuel"},
    {code:"R24",def:"Signaux d'arr√™t"},
    {code:"R25",def:"Signal d'arr√™t destin√© aux pi√©tons"},
    {code:"PMV",def:"Panneau √† Message Variable ‚Äî affiche des informations dynamiques sur la circulation"}
  ]},
  "Signaux de S√©curit√© Routi√®re (SR)": { badge:"badge-panonceaux", emoji:"üõ°Ô∏è", description:"Signaux de rappel des r√®gles de s√©curit√© routi√®re.", items:[
    {code:"SR2a",def:"Rappelle l'espacement minimum √† laisser entre les v√©hicules sur autoroute et 2x2 voies"},
    {code:"SR2b",def:"Rappelle l'espacement minimum entre v√©hicules (variante autoroute)"},
    {code:"SR2c",def:"Rappelle l'espacement minimum entre v√©hicules (variante route √† chauss√©es s√©par√©es)"},
    {code:"SR3",def:"Annonce une zone o√π la vitesse est contr√¥l√©e par radar automatique"},
    {code:"SR4",def:"Annonce une zone sous vid√©osurveillance pour la s√©curit√© et r√©gulation du trafic"},
    {code:"SR50",def:"Signal rappelant un message de s√©curit√© routi√®re de port√©e g√©n√©rale"}
  ]},
  "Signalisation de Chantier (K)": { badge:"badge-danger", emoji:"üî∂", description:"Balises, barrages et signalisation temporaire de chantier.", items:[
    {code:"K2",def:"Barrages ‚Äî signalisation de position de travaux ou obstacle temporaire"},
    {code:"K5a",def:"Dispositif conique ‚Äî signalisation des limites d'obstacles temporaires ou de chantier"},
    {code:"K5b",def:"Piquet ‚Äî signalisation des limites d'obstacles temporaires"},
    {code:"K5c",def:"Balise d'alignement ‚Äî signalisation des limites d'obstacles temporaires"},
    {code:"K5d",def:"Balise de guidage ‚Äî signalisation des limites d'obstacles temporaires"},
    {code:"K8",def:"Signal de position d'une d√©viation ou r√©tr√©cissement temporaire de chauss√©e"},
    {code:"K10",def:"Signal servant √† r√©gler manuellement la circulation"},
    {code:"K14",def:"Ruban ‚Äî signal de d√©limitation de chantier ou fermeture d'un passage √† niveau"},
    {code:"K15",def:"Portique ‚Äî signal de pr√©signalisation de gabarit limit√©"},
    {code:"K16",def:"S√©parateur modulaire de voie ‚Äî dispositif de s√©paration et guidage"},
    {code:"KC1",def:"Indication de chantier important ou de situations diverses"},
    {code:"KD8",def:"Pr√©signalisation de changement de chauss√©e ou de trajectoire"},
    {code:"KD9",def:"Affectation de voies de chantier"},
    {code:"KD10a",def:"Annonce de la r√©duction du nombre de voies sur routes √† chauss√©es s√©par√©es"},
    {code:"KD21",def:"Direction de d√©viation avec mention de la ville"},
    {code:"KD22",def:"Direction de d√©viation"},
    {code:"KD42",def:"Pr√©signalisation de d√©viation"},
    {code:"KD43",def:"Pr√©signalisation courante de chantier"},
    {code:"KD62",def:"Confirmation de d√©viation"},
    {code:"KD69",def:"Fin de d√©viation"},
    {code:"KR11",def:"Signaux tricolores d'alternat temporaire"},
    {code:"KR41",def:"Rampe lumineuse ‚Äî indique le c√¥t√© par lequel contourner un v√©hicule d'intervention"},
    {code:"KR42",def:"Fl√®che lumineuse ‚Äî indique le c√¥t√© vers lequel se d√©porter"},
    {code:"KR43",def:"Fl√®che lumineuse ‚Äî obligation de se d√©porter vers la voie adjacente indiqu√©e"},
    {code:"KM1",def:"Panonceau de distance associ√© aux panneaux temporaires"},
    {code:"KM2",def:"Panonceau d'√©tendue associ√© aux panneaux temporaires"},
    {code:"KM9",def:"Panonceau d'indications diverses associ√© aux panneaux temporaires de danger AK"}
  ]},
  "Passages √† Niveau (G)": { badge:"badge-danger", emoji:"üöÇ", description:"Signaux sp√©cifiques aux passages √† niveau.", items:[
    {code:"G1",def:"Signal de position d'un passage √† niveau √† une voie sans barri√®res ni signalisation automatique"},
    {code:"G1bis",def:"Signal de position d'un passage √† niveau √† une voie avec signalisation automatique lumineuse et sonore"},
    {code:"G1a",def:"Signal de position d'un passage √† niveau √† plusieurs voies sans barri√®res ni signalisation automatique"},
    {code:"G1b",def:"Signal de position d'un passage √† niveau ou aire de danger a√©rien (variante)"},
    {code:"G1c",def:"Signal de position d'un passage √† niveau √† plusieurs voies (variante)"},
    {code:"G2",def:"Signalisation automatique avec feu rouge clignotant et demi-barri√®res automatiques"},
    {code:"G3",def:"Portique ‚Äî signalisation des passages √† niveau avec voies √©lectrifi√©es (fils < 6 m de hauteur)"},
    {code:"J1",def:"Balisage des virages"},
    {code:"J3",def:"Signalisation de position des intersections de routes"},
    {code:"J4",def:"Balisage de virages (variante)"},
    {code:"J5",def:"Signalisation des t√™tes d'√Ælots directionnels √† contournement par la droite"},
    {code:"J6",def:"D√©lin√©ateur ‚Äî balisage des limites de chauss√©es"},
    {code:"J7",def:"Manche √† air ‚Äî balise indiquant l'endroit o√π souffle fr√©quemment un vent lat√©ral violent"},
    {code:"J10",def:"Balise pour passage √† niveau"},
    {code:"J13",def:"Balise de signalisation d'obstacle"},
    {code:"J14a",def:"Balises de musoir signalant la divergence des voies"},
    {code:"J14b",def:"Balises de musoir signalant la divergence des voies (variante)"}
  ]}
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// NAVIGATION COURS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
var pannSourceScreen = 'screen-cours';




// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// PANNEAUX INDEX & NAVIGATION
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

var pannCurrentCat = null;
var pannMode = 'learn';
var pannQuizState = { questions:[], current:0, score:0, answered:[] };

function openPanneauxCat(catName) {
    pannCurrentCat = catName;
    var cat = panneauxDB[catName];
    document.getElementById('pannTitle').textContent = cat.emoji + ' ' + catName;
    document.getElementById('pannSub').textContent = cat.description;
    var searchEl = document.getElementById('pannSearch');
    if (searchEl) searchEl.value = '';
    setPannMode('learn');
    renderPannList(cat.items);
    document.querySelector('#screen-panneaux .back-btn').onclick = function() {
        openPanneauxIndex();
    };
    showScreen('screen-panneaux');
}

function setPannMode(mode) {
    pannMode = mode;
    document.getElementById('tab-learn').classList.toggle('active', mode==='learn');
    document.getElementById('tab-quiz').classList.toggle('active', mode==='quiz');
    document.getElementById('pannLearnView').style.display = mode==='learn' ? 'block' : 'none';
    document.getElementById('pannQuizView').style.display = mode==='quiz' ? 'block' : 'none';
    if (mode === 'quiz') startPannQuiz();
}

function renderPannList(items) {
    var cat = panneauxDB[pannCurrentCat];
    var list = document.getElementById('pannList');
    var countEl = document.getElementById('pannCount');
    if (countEl) countEl.textContent = items.length + ' panneau(x)';
    var h = '<span class="panneau-cat-badge ' + cat.badge + '">' + cat.emoji + ' ' + pannCurrentCat + '</span>';
    items.forEach(function(p) {
        h += '<div class="panneau-list-item"><span class="panneau-code">' + p.code + '</span><span class="panneau-def">' + p.def + '</span></div>';
    });
    list.innerHTML = h;
}

function filterPanneaux() {
    var q = document.getElementById('pannSearch').value.toLowerCase();
    var cat = panneauxDB[pannCurrentCat];
    var filtered = cat.items.filter(function(p) {
        return p.code.toLowerCase().indexOf(q) !== -1 || p.def.toLowerCase().indexOf(q) !== -1;
    });
    renderPannList(filtered);
}

function startPannQuiz() {
    var cat = panneauxDB[pannCurrentCat];
    var allItems = cat.items;
    if (allItems.length < 4) {
        document.getElementById('pannQuizContainer').innerHTML = '<div class="info-rule">Pas assez de panneaux pour un quiz (minimum 4 requis).</div>';
        return;
    }
    var shuffled = allItems.slice().sort(function() { return Math.random()-0.5; });
    var questions = shuffled.slice(0, Math.min(10, allItems.length)).map(function(correct) {
        var wrongs = allItems.filter(function(p) { return p.code !== correct.code; })
            .sort(function() { return Math.random()-0.5; }).slice(0,3);
        var opts = [correct].concat(wrongs).sort(function() { return Math.random()-0.5; });
        return { correct: correct.code, opts: opts };
    });
    pannQuizState = { questions:questions, current:0, score:0, answered:new Array(questions.length).fill(null), selectedIdx:-1 };
    renderPannQuiz();
}

function renderPannQuiz() {
    var qs = pannQuizState;
    var container = document.getElementById('pannQuizContainer');
    if (qs.current >= qs.questions.length) {
        var pct = Math.round(qs.score/qs.questions.length*100);
        container.innerHTML = '<div class="quiz-pann-score">' + (pct>=70?'üéâ':'üìö') +
            ' Score : ' + qs.score + '/' + qs.questions.length + ' (' + pct + '%)<br>' +
            '<span style="font-size:1rem;color:var(--text-muted);font-weight:400">' +
            (pct>=70?'Bravo ! Bonne ma√Ætrise.':'Continuez √† r√©viser !') + '</span></div>' +
            '<button class="btn" onclick="startPannQuiz()">‚Ü∫ Recommencer</button>';
        return;
    }
    var q = qs.questions[qs.current];
    var answered = qs.answered[qs.current];
    var optsHtml = q.opts.map(function(o, i) {
        var cls = 'pann-opt';
        if (answered !== null) {
            cls += ' locked';
            if (o.code === q.correct) cls += ' correct';
            else if (i === qs.selectedIdx) cls += ' incorrect';
        }
        return '<button class="' + cls + '" onclick="answerPannQuiz(' + i + ',\'' + o.code + '\')">' + o.def + '</button>';
    }).join('');
    var feedbackHtml = '';
    if (answered !== null) {
        if (answered) feedbackHtml = '<div class="quiz-pann-feedback show ok">‚úÖ Bonne r√©ponse !</div>';
        else {
            var correctDef = q.opts.find(function(o) { return o.code === q.correct; });
            feedbackHtml = '<div class="quiz-pann-feedback show ko">‚ùå R√©ponse : ' + (correctDef?correctDef.def:'') + '</div>';
        }
    }
    container.innerHTML =
        '<div style="font-size:0.8rem;color:var(--text-muted);margin-bottom:0.75rem">Question ' + (qs.current+1) + '/' + qs.questions.length + ' ¬∑ Score: ' + qs.score + '</div>' +
        '<div class="progress-bar" style="margin-bottom:1rem"><div class="progress-fill" style="width:' + (qs.current/qs.questions.length*100) + '%"></div></div>' +
        '<div class="quiz-pann-card' + (answered!==null?(answered?' correct':' incorrect'):'') + '">' +
        '<div class="quiz-pann-q">√Ä quoi correspond le panneau <strong style=\'color:var(--primary)\'>' + q.correct + '</strong> ?</div>' +
        '<div class="quiz-pann-opts">' + optsHtml + '</div>' + feedbackHtml + '</div>' +
        (answered!==null ? '<button class="btn" style="margin-top:0.75rem" onclick="nextPannQuestion()">' + (qs.current+1<qs.questions.length?'Suivant ‚Üí':'Voir le score ‚Üí') + '</button>' : '');
}

function answerPannQuiz(idx, code) {
    if (pannQuizState.answered[pannQuizState.current] !== null) return;
    var correct = code === pannQuizState.questions[pannQuizState.current].correct;
    pannQuizState.answered[pannQuizState.current] = correct;
    pannQuizState.selectedIdx = idx;
    if (correct) pannQuizState.score++;
    renderPannQuiz();
}

function nextPannQuestion() {
    pannQuizState.current++;
    renderPannQuiz();
}

// Init
document.addEventListener('DOMContentLoaded', function() {
    renderSeriesGrid();
    showScreen('screen-welcome');
});
</script>

<!-- ‚ïê‚ïê PANNEAUX SCREEN ‚ïê‚ïê -->
<div class="screen" id="screen-panneaux">
    
    <div class="card">
        <div class="series-title" id="pannTitle">Panneaux</div>
        <div class="series-sub" id="pannSub"></div>

        <!-- Onglets modes -->
        <div class="cat-tabs" id="pannModeTabs">
            <button class="cat-tab active" onclick="setPannMode('learn')" id="tab-learn">üìñ Apprendre</button>
            <button class="cat-tab" onclick="setPannMode('quiz')" id="tab-quiz">üéØ S'exercer</button>
        </div>

        <!-- MODE APPRENDRE -->
        <div id="pannLearnView">
            <input type="text" class="search-box" id="pannSearch" placeholder="üîç Rechercher un panneau (ex: B1, STOP, interdit...)" oninput="filterPanneaux()">
            <div class="panneaux-count" id="pannCount"></div>
            <div id="pannList"></div>
        </div>

        <!-- MODE QUIZ -->
        <div id="pannQuizView" style="display:none">
            <div id="pannQuizContainer"></div>
        </div>
    </div>
</div>

</body>
</html>